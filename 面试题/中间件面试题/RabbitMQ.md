# RabbitMQ的使用场景有哪些？

抢购活动，削峰填谷，防止系统崩塌。

延迟信息处理，比如10分钟之后给下单未付款的用户发送邮件提醒。解耦系统，对于新增的功能可以单独写模块扩展，比如用户确认评价之后，新增了给用户返积分的功能，这个时候不用在业务代码里添加新增积分的功能，只需要把新增积分的接口订阅确认评价的消息队列即可，后面再添加任何功能只需要订阅对应的消息队列即可。
# RabbitMQ有哪些重要的角色？

RabbitMQ中重要的角色有：生产者、消费者和代理：

生产者：消息的创建者，负责创建和推送数据到消息服务器；

消费者：消息的接收方，用于处理数据和确认消息；

代理：就是RabbitMQ本身，用于扮演“快递”的角色，本身不生产消息，只是扮演“快递”的角色。
# RabbitMQ有哪些重要的组件？

ConnectionFactory（连接管理器）：应用程序与Rabbit之间建立连接的管理器，程序代码中使用。

Channel（信道）：消息推送使用的通道。

Exchange（交换器）：用于接受、分配消息。

Queue（队列）：用于存储生产者的消息。

RoutingKey（路由键）：用于把生成者的数据分配到交换器上。

BindingKey（绑定键）：用于把交换器的消息绑定到队列上。
# RabbitMQ中vhost的作用是什么？

vhost：每个RabbitMQ都能创建很多vhost，我们称之为虚拟主机，每个虚拟主机其实都是mini版的RabbitMQ，它拥有自己的队列，交换器和绑定，拥有自己的权限机制。
# RabbitMQ的消息是怎么发送的？

首先客户端必须连接到RabbitMQ服务器才能发布和消费消息，客户端和rabbit server之间会创建一个tcp连接，一旦tcp打开并通过了认证（认证就是你发送给rabbit服务器的用户名和密码），你的客户端和RabbitMQ就创建了一条amqp信道（channel），信道是创建在“真实”tcp上的虚拟连接，amqp命令都是通过信道发送出去的，每个信道都会有一个唯一的id，不论是发布消息，订阅队列都是通过这个信道完成的。
# RabbitMQ怎么保证消息的稳定性？

提供了事务的功能。

通过将channel设置为confirm（确认）模式。
# RabbitMQ怎么避免消息丢失？

把消息持久化磁盘，保证服务器重启消息不丢失。

每个集群中至少有一个物理磁盘，保证消息落入磁盘。

# 要保证消息持久化成功的条件有哪些？

声明队列必须设置持久化durable设置为true.

消息推送投递模式必须设置持久化，deliveryMode设置为2（持久）。

消息已经到达持久化交换器。

消息已经到达持久化队列。

以上四个条件都满足才能保证消息持久化成功。
# RabbitMQ持久化有什么缺点？

持久化的缺地就是降低了服务器的吞吐量，因为使用的是磁盘而非内存存储，从而降低了吞吐量。可尽量使用ssd硬盘来缓解吞吐量的问题。
# RabbitMQ有几种广播类型？

direct（默认方式）：最基础最简单的模式，发送方把消息发送给订阅方，如果有多个订阅者，默认采取轮询的方式进行消息发送。

headers：与direct类似，只是性能很差，此类型几乎用不到。

fanout：分发模式，把消费分发给所有订阅者。

topic：匹配订阅模式，使用正则匹配到消息队列，能匹配到的都能接收到。
# RabbitMQ怎么实现延迟消息队列？

延迟队列的实现有两种方式：

通过消息过期后进入死信交换器，再由交换器转发到延迟消费队列，实现延迟功能；

使用RabbitMQ-delayed-message-exchange插件实现延迟功能。
# RabbitMQ集群有什么用？

集群主要有以下两个用途：

高可用：某个服务器出现问题，整个RabbitMQ还可以继续使用；

高容量：集群可以承载更多的消息量。
# RabbitMQ节点的类型有哪些？

磁盘节点：消息会存储到磁盘。

内存节点：消息都存储在内存中，重启服务器消息丢失，性能高于磁盘类型。
# RabbitMQ集群搭建需要注意哪些问题？

各节点之间使用“–link”连接，此属性不能忽略。

各节点使用的erlang cookie值必须相同，此值相当于“秘钥”的功能，用于各节点的认证。整个集群中必须包含一个磁盘节点。
# RabbitMQ每个节点是其他节点的完整拷贝吗？为什么？

不是，原因有以下两个：

存储空间的考虑：如果每个节点都拥有所有队列的完全拷贝，这样新增节点不但没有新增存储空间，反而增加了更多的冗余数据；

性能的考虑：如果每条消息都需要完整拷贝到每一个集群节点，那新增节点并没有提升处理消息的能力，最多是保持和单节点相同的性能甚至是更糟。
# RabbitMQ集群中唯一一个磁盘节点崩溃了会发生什么情况？

如果唯一磁盘的磁盘节点崩溃了，不能进行以下操作：

不能创建队列

不能创建交换器

不能创建绑定

不能添加用户

不能更改权限

不能添加和删除集群节点

唯一磁盘节点崩溃了，集群是可以保持运行的，但你不能更改任何东西。
# RabbitMQ对集群节点停止顺序有要求吗？

RabbitMQ对集群的停止的顺序是有要求的，应该先关闭内存节点，最后再关闭磁盘节点。如果顺序恰好相反的话，可能会造成消息的丢失。