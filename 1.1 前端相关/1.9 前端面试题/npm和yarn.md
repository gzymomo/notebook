å¯¹äºè¿™ä¸ªé—®é¢˜,æˆ‘çªç„¶è¢«é—®åˆ°çš„æ—¶å€™,ä¼šæœ‰ä¸€ç‚¹å¾ˆä¸çŸ¥æ‰€æªçš„æ„Ÿè§‰;è™½ç„¶æˆ‘çœ‹è¿‡ä¸€äº›ç›¸å…³çš„æ–‡ç« ,ä½†æ˜¯åœ¨æˆ‘çš„å°è„‘å£³ä¸­å´æ²¡æœ‰ä¸€ç‚¹å°è±¡ã€‚

ä»Šå¤©ï¼Œæˆ‘ä¼šä»`npm`å’Œ`yarn`çš„å‡ºç°ï¼Œç‰ˆæœ¬çš„å˜åŒ–å’Œä¼˜åŒ–ï¼Œå®‰è£…åŸç†å’Œåœ¨å®è·µçš„ä¸€äº›å»ºè®®ç­‰æ–¹é¢ï¼Œæ…¢æ…¢çš„æ¥å” å” å®ƒä»¬ä¹‹é—´çš„è¿™äº›äº‹ã€‚

##### æ—©æœŸçš„npm

å…¶å®åœ¨æœ€æ—©æœŸçš„`npm`ç‰ˆæœ¬(npm v2)ï¼Œ`npm`çš„è®¾è®¡å¯ä»¥è¯´æ˜¯éå¸¸çš„ç®€å•,åœ¨å®‰è£…ä¾èµ–çš„æ—¶å€™ä¼šå°†ä¾èµ–æ”¾åˆ°` node_modules`æ–‡ä»¶ä¸­; åŒæ—¶,å¦‚æœæŸä¸ªç›´æ¥ä¾èµ–Aä¾èµ–äºå…¶ä»–çš„ä¾èµ–åŒ…B,é‚£ä¹ˆä¾èµ–Bä¼šä½œä¸ºé—´æ¥ä¾èµ–,å®‰è£…åˆ°ä¾èµ–Açš„æ–‡ä»¶å¤¹`node_modules`ä¸­,ç„¶åå¯èƒ½å¤šä¸ªåŒ…ä¹‹é—´ä¹Ÿä¼šæœ‰å‡ºç°åŒæ ·çš„ä¾èµ–é€’å½’çš„,å¦‚æœé¡¹ç›®ä¸€æ—¦è¿‡å¤§,é‚£ä¹ˆå¿…ç„¶ä¼šå½¢æˆä¸€æ£µå·¨å¤§çš„ä¾èµ–æ ‘ï¼Œä¾èµ–åŒ…ä¼šå‡ºç°é‡å¤,å½¢æˆ`åµŒå¥—åœ°ç‹±`ã€‚

```
é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•å»ç†è§£"åµŒå¥—åœ°ç‹±"å‘¢ï¼Ÿ
```

- é¦–å…ˆ,é¡¹ç›®çš„ä¾èµ–æ ‘çš„å±‚çº§è¿‡äºæ·±ï¼Œå¦‚æœæœ‰é—®é¢˜ä¸åˆ©äºæ’æŸ¥å’Œè°ƒè¯•
- åœ¨ä¾èµ–çš„åˆ†æ”¯ä¸­,å¯èƒ½ä¼šå‡ºç°åŒæ ·ç‰ˆæœ¬çš„ç›¸äº’ä¾èµ–çš„é—®é¢˜

é‚£ä¹ˆè¿™æ ·çš„é‡å¤é—®é¢˜ä¼šå¸¦æ¥ä»€ä¹ˆåæœå‘¢ï¼Ÿ

- é¦–å…ˆ,ä¼šä½¿å¾—å®‰è£…çš„ç»“æœå æ®äº†å¤§é‡çš„ç©ºé—´èµ„æº,é€ æˆäº†èµ„æºçš„æµªè´¹
- åŒæ—¶,å› ä¸ºå®‰è£…çš„ä¾èµ–é‡å¤,ä¼šé€ æˆåœ¨å®‰è£…ä¾èµ–æ—¶,å®‰è£…æ—¶é—´è¿‡é•¿
- ç”šè‡³æ˜¯,å› ä¸ºç›®å½•å±‚çº§è¿‡æ·±,å¯¼è‡´æ–‡ä»¶è·¯å¾„è¿‡é•¿,ä¼šåœ¨`windows`ç³»ç»Ÿä¸‹åˆ é™¤`node_modules`æ–‡ä»¶,å‡ºç°åˆ é™¤ä¸æ‰çš„æƒ…å†µ

é‚£ä¹ˆ, åé¢çš„ç‰ˆæœ¬æ˜¯å¦‚ä½•ä¸€æ­¥æ­¥è¿›è¡Œä¼˜åŒ–çš„å‘¢ï¼Ÿåé¢ä¼šé™†ç»­çš„æ­æ™“ã€‚

##### npm or yarn å¼€å‘ä¸­çš„ä¸€ç‚¹ç–‘æƒ‘

ä½ åœ¨å®é™…çš„å¼€å‘ä¼šä¸ä¼šå‡ºç°è¿™æ ·çš„ä¸€äº›æƒ…å†µ

1. å½“ä½ é¡¹ç›®ä¾èµ–å‡ºç°é—®é¢˜çš„æ—¶å€™, æˆ‘ä»¬ä¼šä¸ä¼šæ˜¯ç›´æ¥åˆ é™¤`      node_modules å’Œ lockfiles`ä¾èµ–, å†é‡æ–° `npm install`,åˆ é™¤å¤§æ³•æ˜¯å¦çœŸçš„å¥½ç”¨?è¿™æ ·çš„ä½¿ç”¨æ–¹æ¡ˆä¼šä¸ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Ÿ
2. æŠŠæ‰€æœ‰çš„ä¾èµ–åŒ…éƒ½å®‰è£…åˆ°`dependencies`ä¸­,å¯¹`devDependencies` ä¸åŒºåˆ†ä¼šä¸ä¼šæœ‰é—®é¢˜?
3. ä¸€ä¸ªé¡¹ç›®ä¸­, ä½ ä½¿ç”¨ `yarn`, æˆ‘ä½¿ç”¨`npm`ï¼Œä¼šä¸ä¼šæœ‰é—®é¢˜å‘¢ï¼Ÿ
4. è¿˜æœ‰ä¸€ä¸ªé—®é¢˜, `lockfiles æ–‡ä»¶` æˆ‘ä»¬æäº¤ä»£ç çš„æ—¶å€™éœ€ä¸éœ€è¦æäº¤åˆ°ä»“åº“ä¸­å‘¢ï¼Ÿ

å…¶å®,æˆ‘å¯¹äºä¸Šé¢æå‡ºçš„é—®é¢˜ä¹Ÿæ˜¯å‡ºäºä¸€ç§ä¸€çŸ¥åŠè§£çš„çŠ¶æ€ã€‚

æ‰€ä»¥,ä¸–ç•Œè¿™ä¹ˆå¤§, æˆ‘æƒ³å»çœ‹çœ‹è¿™ä¸¤ä¸ªå…„å¼Ÿä¹‹é—´åˆ°åº•æ˜¯æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ

##### npmçš„å®‰è£…æœºåˆ¶å’Œæ ¸å¿ƒåŸç†

æˆ‘ä»¬å¯ä»¥å…ˆæ¥çœ‹çœ‹ npm çš„æ ¸å¿ƒç›®æ ‡

```
Bring the best of open source to you, your team and your company.
å¤åˆ¶ä»£ç 
```

æ„æ€æ˜¯ ç»™ä½ å’Œä½ çš„å›¢é˜Ÿã€ä½ çš„å…¬å¸å¸¦æ¥æœ€å¥½çš„å¼€æºåº“å’Œä¾èµ–ã€‚ é€šè¿‡è¿™å¥è¯,æˆ‘ä»¬å¯ä»¥äº†è§£åˆ° npm æœ€é‡è¦çš„ä¸€ç‚¹å°±æ˜¯å®‰è£…å’Œç»´æŠ¤ä¾èµ–ã€‚é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€çœ‹`npm`çš„å®‰è£…æœºåˆ¶æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ

###### npmçš„å®‰è£…æœºåˆ¶

ä¸‹é¢æˆ‘ä»¬ä¼šé€šè¿‡ä¸€ä¸ªæµç¨‹å›¾æ¥å…·ä½“å­¦ä¹ `npm install`çš„å®‰è£…æœºåˆ¶

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4fbc0e4e27c14500a2a9e4fcf4757fae~tplv-k3u1fbpfcp-watermark.awebp?)

`npm install`æ‰§è¡Œä¹‹å, é¦–å…ˆä¼šæ£€æŸ¥å’Œè·å– `npmçš„é…ç½®`,è¿™é‡Œçš„ä¼˜å…ˆçº§ä¸º:

```
é¡¹ç›®çº§çš„.npmrcæ–‡ä»¶ > ç”¨æˆ·çº§çš„ .npmrcæ–‡ä»¶ > å…¨å±€çº§çš„ .npmrc > npmå†…ç½®çš„ .npmrc æ–‡ä»¶
```

ç„¶åæ£€æŸ¥é¡¹ç›®ä¸­æ˜¯å¦æœ‰ `package-lock.json`æ–‡ä»¶

- å¦‚æœæœ‰, æ£€æŸ¥ `package-lock.json`å’Œ `package.json`å£°æ˜çš„ä¾èµ–æ˜¯å¦ä¸€è‡´ï¼š
  - ä¸€è‡´, ç›´æ¥ä½¿ç”¨`package-lock.json`ä¸­çš„ä¿¡æ¯,ä»ç½‘ç»œæˆ–è€…ç¼“å­˜ä¸­åŠ è½½ä¾èµ–
  - ä¸ä¸€è‡´, æ ¹æ®ä¸Šè¿°æµç¨‹ä¸­çš„ä¸åŒç‰ˆæœ¬è¿›è¡Œå¤„ç†
- å¦‚æœæ²¡æœ‰, é‚£ä¹ˆä¼šæ ¹æ®`package.json`é€’å½’æ„å»ºä¾èµ–æ ‘,ç„¶åå°±ä¼šæ ¹æ®æ„å»ºå¥½çš„ä¾èµ–å»ä¸‹è½½å®Œæ•´çš„ä¾èµ–èµ„æº,åœ¨ä¸‹è½½çš„æ—¶å€™,ä¼šæ£€æŸ¥æœ‰æ²¡æœ‰ç›¸å…³çš„èµ„æºç¼“å­˜:
  - å­˜åœ¨, ç›´æ¥è§£å‹åˆ°`node_modules`æ–‡ä»¶ä¸­
  - ä¸å­˜åœ¨, ä»npmè¿œç«¯ä»“åº“ä¸‹è½½åŒ…,æ ¡éªŒåŒ…çš„å®Œæ•´æ€§,åŒæ—¶æ·»åŠ åˆ°ç¼“å­˜ä¸­,è§£å‹åˆ° `node_modules`ä¸­

æœ€å, ç”Ÿæˆ `package-lock.json` æ–‡ä»¶

å…¶å®, åœ¨æˆ‘ä»¬å®é™…çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œä½¿ç”¨npmä½œä¸ºå›¢é˜Ÿçš„æœ€ä½³å®è·µ: `åŒä¸€ä¸ªé¡¹ç›®å›¢é˜Ÿ,åº”è¯¥ä¿æŒnpm ç‰ˆæœ¬çš„ä¸€è‡´æ€§`ã€‚

ä»ä¸Šé¢çš„å®‰è£…æµç¨‹,ä¸çŸ¥é“å¤§å®¶æ³¨æ„åˆ°äº†ä¸€ç‚¹æ²¡æœ‰,åœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­,å¦‚æœæ¯æ¬¡éƒ½å»å®‰è£…å¯¹åº”ä¾èµ–æ—¶,å¦‚æœç›¸å…³çš„ä¾èµ–åŒ…ä½“ç§¯è¿‡å¤§æˆ–è€…æ˜¯ä¾èµ–äºç½‘ç»œ,æ— ç–‘ä¼šå¢åŠ å®‰è£…çš„æ—¶é—´æˆæœ¬;é‚£ä¹ˆ,ç¼“å­˜åœ¨è¿™é‡Œçš„å°±æ˜¯ä¸€ä¸ªè§£å†³é—®é¢˜çš„å¥½åŠæ³•,åé¢æˆ‘ä»¬ä¼šåšå…·ä½“çš„ä»‹ç»ã€‚

##### yarnçš„å‡ºç°

yarn æ˜¯ä¸€ä¸ªç”±`Facebook`ã€`Google`ã€`Exponent`å’Œ`Tilde`æ„å»ºçš„æ–°çš„JavaScriptåŒ…ç®¡ç†å™¨ã€‚å®ƒçš„å‡ºç°æ˜¯ä¸ºäº†è§£å†³å†å²ä¸Š`npm`çš„æŸäº›ä¸è¶³(æ¯”å¦‚npmå¯¹äºä¾èµ–çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§çš„ä¿è¯,ä»¥åŠnpmå®‰è£…è¿‡ç¨‹ä¸­é€Ÿåº¦å¾ˆæ…¢çš„é—®é¢˜)

å½“npmè¿˜å¤„äº`v3`æ—¶æœŸçš„æ—¶å€™,ä¸€ä¸ªå«`yarn`çš„åŒ…ç®¡ç†å·¥å…·æ¨ªç©ºå‡ºä¸–.åœ¨2016å¹´, npmè¿˜æ²¡æœ‰package-lock.jsonæ–‡ä»¶,å®‰è£…çš„æ—¶å€™é€Ÿåº¦å¾ˆæ…¢,ç¨³å®šæ€§å¾ˆå·®,`yarn`çš„å‡ºç°å¾ˆå¥½çš„è§£å†³äº†ä¸€ä¸‹çš„ä¸€äº›é—®é¢˜:

- **ç¡®å®šæ€§:** é€šè¿‡yarn.lockç­‰æœºåˆ¶,å³ä½¿æ˜¯ä¸åŒçš„å®‰è£…é¡ºåº,ç›¸åŒçš„ä¾èµ–å…³ç³»åœ¨ä»»ä½•çš„ç¯å¢ƒå’Œå®¹å™¨ä¸­,éƒ½å¯ä»¥ä»¥ç›¸åŒçš„æ–¹å¼å®‰è£…ã€‚(é‚£ä¹ˆ,æ­¤æ—¶çš„npm v5ä¹‹å‰,å¹¶æ²¡æœ‰package-lock.jsonæœºåˆ¶,åªæœ‰é»˜è®¤å¹¶ä¸ä¼šä½¿ç”¨ [npm-shrinkwrap.json](https://link.juejin.cn?target=https%3A%2F%2Fdocs.npmjs.com%2Fcli%2Fv8%2Fcommands%2Fnpm-shrinkwrap))
- **é‡‡ç”¨æ¨¡å—æ‰å¹³åŒ–çš„å®‰è£…æ¨¡å¼:** å°†ä¸åŒç‰ˆæœ¬çš„ä¾èµ–åŒ…,æŒ‰ç…§ä¸€å®šçš„ç­–ç•¥ï¼Œå½’ç»“ä¸ºå•ä¸ªç‰ˆæœ¬;ä»¥é¿å…åˆ›å»ºå¤šä¸ªç‰ˆæœ¬é€ æˆå·¥ç¨‹çš„å†—ä½™(ç›®å‰ç‰ˆæœ¬çš„npmä¹Ÿæœ‰ç›¸åŒçš„ä¼˜åŒ–)
- **ç½‘ç»œæ€§èƒ½æ›´å¥½:** `yarn`é‡‡ç”¨äº†è¯·æ±‚æ’é˜Ÿçš„ç†å¿µ,ç±»ä¼¼äºå¹¶å‘æ± è¿æ¥,èƒ½å¤Ÿæ›´å¥½çš„åˆ©ç”¨ç½‘ç»œèµ„æº;åŒæ—¶ä¹Ÿå¼•å…¥äº†ä¸€ç§å®‰è£…å¤±è´¥çš„é‡è¯•æœºåˆ¶
- **é‡‡ç”¨ç¼“å­˜æœºåˆ¶,å®ç°äº†ç¦»çº¿æ¨¡å¼** (ç›®å‰çš„npmä¹Ÿæœ‰ç±»ä¼¼çš„å®ç°)

æˆ‘ä»¬å¯ä»¥æ¥çœ‹ä¸€ä¸‹ `yarn.lock`çš„ç»“æ„:

```
"@babel/cli@^7.1.6", "@babel/cli@^7.5.5":
  version "7.8.4"
  resolved "http://npm.in.zhihu.com/@babel%2fcli/-/cli-7.8.4.tgz#505fb053721a98777b2b175323ea4f090b7d3c1c"
  integrity sha1-UF+wU3IamHd7KxdTI+pPCQt9PBw=
  dependencies:
    commander "^4.0.1"
    convert-source-map "^1.1.0"
    fs-readdir-recursive "^1.1.0"
    glob "^7.0.0"
    lodash "^4.17.13"
    make-dir "^2.1.0"
    slash "^2.0.0"
    source-map "^0.5.0"
  optionalDependencies:
    chokidar "^2.1.8"
å¤åˆ¶ä»£ç 
```

ç†Ÿæ‚‰npmçš„`package-lock.json`æ–‡ä»¶çš„æœ‹å‹,å¯èƒ½ä¸€çœ¼å°±çœ‹åˆ°äº†ä¸€äº›ä¸åŒ; `package-lock.json`é‡‡ç”¨çš„æ˜¯`JSON`çš„ç»“æ„,è€Œ`yarn`å¹¶æ²¡æœ‰é‡‡ç”¨è¿™ç§ç»“æ„,è€Œæ˜¯ä¸€ç§è‡ªå®šä¹‰çš„æ ‡è®°æ–¹å¼;æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ–°çš„è‡ªå®šä¹‰çš„æ–¹å¼,ä¹ŸåŒæ ·ä¿æŒäº†é«˜åº¦çš„å¯è¯»æ€§ã€‚

**ç›¸æ¯”äºnpm,Yarnå¦ä¸€ä¸ªæ˜¾è‘—çš„åŒºåˆ«å°±æ˜¯yarn.lockçš„å­ä¾èµ–çš„ç‰ˆæœ¬ä¸æ˜¯å›ºå®šçš„ç‰ˆæœ¬**ã€‚è¿™å…¶å®å°±è¯´æ˜äº†ä¸€ä¸ªé—®é¢˜: ä¸€ä¸ªå•ç‹¬çš„`yarn.lock`çš„é—®é¢˜å¹¶ä¸èƒ½ç¡®å®šâœ…`node-modules`çš„æ–‡ä»¶ç»“æ„,è¿˜éœ€è¦`package.json`çš„é…åˆã€‚

å…¶å®åˆ°äº†è¿™é‡Œ,æˆ‘ä¼šæœ‰ä¸€ä¸ªé—®é¢˜,å¦‚ä½•å®ç° `npm åˆ° yarn çš„åˆ‡æ¢å‘¢ï¼Ÿ`

è¿™é‡Œ æˆ‘äº†è§£åˆ°æœ‰ä¸€ä¸ªä¸“é—¨çš„å·¥å…·[synp](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fimsnif%2Fsynp),å®ƒå¯ä»¥å°†`yarn.lock`è½¬æ¢ä¸º`package-lock.json`ï¼Œåä¹‹äº¦ç„¶ã€‚

è¿™é‡Œå¯ä»¥é¡ºå¸¦æä¸€å˜´,`yarn`é»˜è®¤é‡‡ç”¨çš„æ˜¯`perfer-online`æ¨¡å¼,å³ä¼˜å…ˆä½¿ç”¨ç½‘ç»œèµ„æºã€‚å¦‚æœç½‘ç»œèµ„æºè¯·æ±‚å¤±è´¥,å†å»è¯·æ±‚ç¼“å­˜æ•°æ®ã€‚

åˆ°è¿™é‡Œæˆ‘ä»¬åº”è¯¥å¯¹`yarn`æœ‰äº†åˆæ­¥çš„äº†è§£,é‚£æˆ‘ä»¬ç»§ç»­å»çœ‹ä¸€ä¸‹å®ƒçš„å®‰è£…æœºåˆ¶

###### yarnçš„å®‰è£…æœºåˆ¶

ä¸Šé¢ä¸€å°èŠ‚æˆ‘ä»¬å¯¹npmçš„å®‰è£…æœºåˆ¶æœ‰äº†ä¸€äº›åŸºæœ¬çš„äº†è§£,ç°åœ¨è®©æˆ‘ä»¬å…ˆæ¥ç®€å•çš„çœ‹ä¸€ä¸‹`Yarn`çš„å®‰è£…ç†å¿µã€‚

ç®€å•æ¥è¯´, `Yarn`çš„å®‰è£…å¤§è‡´åˆ†ä¸º5ä¸ªæ­¥éª¤:

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4a25fa69736e4f0aacee1372476ece5c~tplv-k3u1fbpfcp-watermark.awebp?)

æ£€æµ‹(checking) ---> è§£æåŒ…(Resolving Packages) ---> è·å–åŒ…(Fetching) ---> é“¾æ¥åŒ…(Linking Packages) ---> æ„å»ºåŒ…(Building Packages)

é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬è¦å¼€å§‹å…·ä½“åˆ†æè¿™äº›è¿‡ç¨‹ä¸­éƒ½åšäº†å“ªäº›äº‹æƒ…:

**æ£€æµ‹åŒ…**

è¿™ä¸€æ­¥ï¼Œæœ€ä¸»è¦çš„ç›®çš„å°±æ˜¯æ£€æµ‹æˆ‘ä»¬çš„é¡¹ç›®ä¸­æ˜¯å¦å­˜åœ¨npmç›¸å…³çš„æ–‡ä»¶,æ¯”å¦‚`package-lock.json`ç­‰;å¦‚æœæœ‰,å°±ä¼šæœ‰ç›¸å…³çš„æç¤ºç”¨æˆ·æ³¨æ„ï¼šè¿™äº›æ–‡ä»¶å¯èƒ½ä¼šå­˜åœ¨å†²çªã€‚åœ¨è¿™ä¸€æ­¥éª¤ä¸­ ä¹Ÿä¼šæ£€æµ‹ç³»ç»ŸOS, CPUç­‰ä¿¡æ¯ã€‚

**è§£æåŒ…**

è¿™ä¸€æ­¥ä¼šè§£æä¾èµ–æ ‘ä¸­çš„æ¯ä¸€ä¸ªåŒ…çš„ä¿¡æ¯:

é¦–å…ˆå‘¢,è·å–åˆ°`é¦–å±‚ä¾èµ–`: ä¹Ÿå°±æ˜¯æˆ‘ä»¬å½“å‰æ‰€å¤„çš„é¡¹ç›®ä¸­çš„`package.json`å®šä¹‰çš„`dependencies`ã€`devDependencies`ã€`optionalDependencies`çš„å†…å®¹ã€‚

ç´§æ¥ç€**ä¼šé‡‡ç”¨éå†é¦–å±‚ä¾èµ–çš„æ–¹å¼æ¥è·å–åŒ…çš„ä¾èµ–ä¿¡æ¯**,ä»¥åŠé€’å½’æŸ¥æ‰¾æ¯ä¸ªä¾èµ–ä¸‹åµŒå¥—ä¾èµ–çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¹¶å°†è§£æè¿‡çš„åŒ…å’Œæ­£åœ¨è¿›è¡Œè§£æåŒ…å‘¢`ç”¨Setæ•°æ®ç»“æ„è¿›è¡Œå­˜å‚¨`,è¿™æ ·å°±å¯ä»¥ä¿è¯`åŒä¸€ç‰ˆæœ¬èŒƒå›´å†…çš„åŒ…`ä¸ä¼šè¿›è¡Œé‡å¤çš„è§£æ:

ä¸¾ä¸ªä¾‹å­

- å¯¹äºæ²¡æœ‰è§£æè¿‡çš„åŒ…A, é¦–æ¬¡å°è¯•ä» `yarn.lock`ä¸­è·å–ç‰ˆæœ¬ä¿¡æ¯,å¹¶ä¸”æ ‡è®°ä¸ºå·²è§£æ
- å¦‚æœåœ¨`yarn.lock`ä¸­æ²¡æœ‰æ‰¾åˆ°åŒ…Aï¼Œ åˆ™å‘`Registry`å‘èµ·è¯·æ±‚è·å–æ»¡è¶³ç‰ˆæœ¬èŒƒå›´å†…çš„å·²çŸ¥çš„æœ€é«˜ç‰ˆæœ¬çš„åŒ…ä¿¡æ¯,è·å–ä¹‹åå°†è¯¥åŒ…æ ‡è®°ä¸ºå·²è§£æã€‚

æ€»ä¹‹ï¼Œç»è¿‡è§£æåŒ…è¿™ä¸€æ­¥ä¹‹åå‘¢,æˆ‘ä»¬å°±å·²ç»ç¡®å®šäº†è§£æåŒ…çš„å…·ä½“ç‰ˆæœ¬ä¿¡æ¯å’ŒåŒ…çš„ä¸‹è½½åœ°å€ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dc863afc75f84c4784627a8e4f7cbd71~tplv-k3u1fbpfcp-watermark.awebp?)

**è·å–åŒ…**

è¿™ä¸€æ­¥é¦–å…ˆæˆ‘ä»¬ä¼šæ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦æœ‰å½“å‰ä¾èµ–çš„åŒ…,åŒæ—¶å‘¢å°†ç¼“å­˜ä¸­ä¸å­˜åœ¨çš„åŒ…ä¸‹è½½åˆ°ç¼“å­˜çš„ç›®å½•ä¸­ã€‚ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªå°é—®é¢˜éœ€è¦å¤§å®¶æ€è€ƒä¸€ä¸‹:

æ¯”å¦‚: å¦‚ä½•å»åˆ¤æ–­ç¼“å­˜ä¸­æœ‰å½“å‰çš„ä¾èµ–åŒ…å‘¢ï¼Ÿ

**å…¶å®å‘¢,åœ¨Yarnä¸­ä¼šæ ¹æ® cacheFolder+[slug](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTrott%2Fslug)+node_modules+pkg.name ç”Ÿæˆä¸€ä¸ªè·¯å¾„;åˆ¤æ–­ç³»ç»Ÿä¸­æ˜¯å¦å­˜åœ¨è¯¥path,å¦‚æœå­˜åœ¨è¯æ˜å·²ç»æœ‰ç¼“å­˜,ä¸ç”¨é‡æ–°ä¸‹è½½ã€‚è¿™ä¸ªpathä¹Ÿå°±æ˜¯ä¾èµ–åŒ…ç¼“å­˜çš„å…·ä½“è·¯å¾„ã€‚**

é‚£ä¹ˆå¯¹äºæ²¡æœ‰å‘½ä¸­çš„ç¼“å­˜åŒ…å‘¢ï¼Ÿåœ¨ `Yarn` ä¸­å­˜åœ¨ä¸€ä¸ªFetché˜Ÿåˆ—,æŒ‰ç…§å…·ä½“çš„è§„åˆ™è¿›è¡Œç½‘ç»œè¯·æ±‚ã€‚å¦‚æœä¸‹è½½çš„åŒ…æ˜¯ä¸€ä¸ªfileåè®®,æˆ–è€…æ˜¯ç›¸å¯¹è·¯å¾„,å°±è¯´æ˜æŒ‡å‘ä¸€ä¸ªæœ¬åœ°ç›®å½•,æ­¤æ—¶ä¼šè°ƒç”¨Fetch From Localä»ç¦»çº¿ç¼“å­˜ä¸­è·å–åŒ…;å¦åˆ™è°ƒç”¨ Fetch From External è·å–åŒ…,æœ€ç»ˆè·å–çš„ç»“æœä½¿ç”¨ fs.createWriteStream å†™å…¥åˆ°ç¼“å­˜ç›®å½•ã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0b43405f73284e37a23c59b725ea1f9c~tplv-k3u1fbpfcp-watermark.awebp?)

**é“¾æ¥åŒ…**

æˆ‘ä»¬ä¸Šä¸€æ­¥å·²ç»æŠŠä¾èµ–æ”¾åˆ°äº†ç¼“å­˜ç›®å½•,é‚£ä¹ˆä¸‹ä¸€æ­¥,æˆ‘ä»¬åº”è¯¥è¦åšä»€ä¹ˆäº‹æƒ…å‘¢ï¼Ÿæ˜¯ä¸æ˜¯åº”è¯¥æŠŠé¡¹ç›®ä¸­çš„ä¾èµ–å¤åˆ¶åˆ°`node_modules`ç›®å½•ä¸‹å‘¢,æ²¡é”™;åªä¸è¿‡æ­¤æ—¶éœ€è¦éµå¾ªä¸€ä¸ªæ‰å¹³åŒ–çš„åŸåˆ™ã€‚å¤åˆ¶ä¾èµ–ä¹‹å‰, `Yarn`ä¼šå…ˆè§£æ `peerDepdencies`ï¼Œå¦‚æœæ‰¾ä¸åˆ°ç¬¦åˆè¦æ±‚çš„`peerDepdencies`çš„åŒ…,ä¼šæœ‰ `warning`æç¤ºï¼Œå¹¶æœ€ç»ˆæ‹·è´ä¾èµ–åˆ°é¡¹ç›®ä¸­ã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/825e548b1f9d41059efa5f2080d0c155~tplv-k3u1fbpfcp-watermark.awebp?) **æ„å»ºåŒ…**

å¦‚æœä¾èµ–åŒ…ä¸­å­˜åœ¨äºŒè¿›åˆ¶åŒ…éœ€è¦è¿›è¡Œç¼–è¯‘ï¼Œé‚£ä¹ˆä¼šåœ¨è¿™ä¸€æ­¥è¿›è¡Œã€‚

`åƒå‘¼ä¸‡å”¤å§‹å‡ºæ¥`,è¿™é‡Œè¦æ’ä¸€å¥è¯,æ„Ÿè°¢å¤§å®¶çš„æ§åœºã€‚ `ä¸ºä¼Šæ¶ˆå¾—äººæ†”æ‚´`,æœ€è¿‘æƒ³çš„äº‹æƒ…æ¯”è¾ƒå¤š,ä¸€ç›´æ‹–ç€å®åœ¨æ˜¯ä¸å¥½æ„æ€ã€‚é‚£æˆ‘ä»¬å¤§å®¶ç»§ç»­æ¥ä¸€èµ·æ•´ç†:

å…¶å®, ä»å¤§å®¶çš„è¯„è®ºä¸­æˆ‘å»è®¤çœŸè®¨è®ºå’Œå­¦åˆ°äº†ä¸€äº›æ–°çš„ä¸œè¥¿[pnmp](https://link.juejin.cn?target=https%3A%2F%2Fwww.pnpm.cn%2F)å’Œ[Lerna](https://link.juejin.cn?target=https%3A%2F%2Fwww.lernajs.cn%2F);ä¹‹åå¦‚æœæ—¶é—´å……è£•çš„è¯,æˆ‘ä¹Ÿä¼šå»ç ”ç©¶ç ”ç©¶å’Œå¤§ä¼™ä¸€èµ·è®¨è®ºçš„,æ„Ÿè°¢å¤§å®¶ä¼™çš„æ”¯æŒ ğŸ’—ã€‚

###### npmçš„ç¼“å­˜æœºåˆ¶

å›å½’æ­£é¢˜,æ¥ä¸‹æ¥è®©æˆ‘ä»¬çœ‹æ¥ä¸€ä¸‹ `npm`çš„å¯¹äº**åŒä¸€ä¸ªç‰ˆæœ¬çš„ä¾èµ–åŒ…æ˜¯å¦‚ä½•è¿›è¡Œæœ¬åœ°åŒ–ç¼“å­˜çš„**

è¿™æ˜¯npmæŸ¥çœ‹æœ¬åœ°ç¼“å­˜çš„å‘½ä»¤:

```
npm config get cache
å¤åˆ¶ä»£ç 
```

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7516838fcf2c42639f6bd2cfd77e9617~tplv-k3u1fbpfcp-watermark.awebp?)

ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºnpmé…ç½®ç¼“å­˜çš„ä½ç½®åœ¨ `/Users/zhaoxxxx/.npm`ï¼ˆmac os çš„é»˜è®¤çš„ç¼“å­˜çš„ä½ç½®ï¼‰å½“ä¸­ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4b2ab2ca967c4c4fa2d26a534c0bf09a~tplv-k3u1fbpfcp-watermark.awebp?)

å…¶å®ä½ ä¹Ÿçœ‹åˆ°äº†`_cacache`çš„ç›®å½•æœ‰ä¸‰ä¸ªæ–‡ä»¶:

- content-v2
- index-v5
- tmp

å…¶ä¸­, content-v2é‡Œé¢å­˜æ”¾çš„æ˜¯ä¸€äº›äºŒè¿›åˆ¶çš„æ–‡ä»¶ã€‚ä¸ºäº†ä½¿äºŒè¿›åˆ¶çš„æ–‡ä»¶å¯è¯»,æˆ‘æŠŠæ–‡ä»¶åšäº†å‹ç¼©å’Œè§£å‹ç¼©å¤„ç†ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5585e524462c415cbaebc26595fc7878~tplv-k3u1fbpfcp-watermark.awebp?)

ç„¶åæŠŠä¸‹é¢çš„æ–‡ä»¶è¿›è¡Œè§£å‹å¤„ç†å°±å¯ä»¥å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„npmçš„å…·ä½“çš„èµ„æº:

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2b22e36004c14999a7242c2cd4ba83e1~tplv-k3u1fbpfcp-watermark.awebp?)

**å‹ç¼©ç»“æœ**

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/be31ba842d6e451383a78e531664b401~tplv-k3u1fbpfcp-watermark.awebp?)

è¿™é‡Œæ¨èä¸€ä¸ª `the unarchiver` è§£å‹ç¼©å·¥å…·,æ”¯æŒæ›´å¤šçš„æ ¼å¼,å¼ºåŠ›æ¨èã€‚

è€Œåœ¨ index-v5æ–‡ä»¶ä¸­å‘¢, æˆ‘ä»¬ä½¿ç”¨å’Œåˆšæ‰ä¸€æ ·çš„æ“ä½œå¯ä»¥å¾—åˆ°ä¸€äº›æè¿°æ€§çš„æ–‡ä»¶ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/68b5fd8a42aa4d26b6dc9f4ca064efdb~tplv-k3u1fbpfcp-watermark.awebp?)

äº‹å®ä¸Šè¿™äº›å†…å®¹å°±æ˜¯ content-v2 æ–‡ä»¶çš„ç´¢å¼•ã€‚

**é‚£ä¹ˆè¿™é‡Œæˆ‘ä¹Ÿæœ‰ä¸€ä¸ªé—®é¢˜è¿™é‡Œçš„ç¼“å­˜æ˜¯å¦‚ä½•å­˜å‚¨å¹¶ä¸”è¢«åˆ©ç”¨çš„å‘¢ï¼Ÿ**

è¿™é‡Œå°±è¦æä¸€ä¸‹ `npm install`çš„å®‰è£…æœºåˆ¶, å½“ npm æ‰§è¡Œçš„æ—¶å€™,é€šè¿‡ [pacote](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fpacote) æŠŠç›¸åº”çš„åŒ…è§£å‹åˆ°å¯¹åº”çš„ `node_modules`ä¸‹é¢ã€‚(è¿™é‡Œé¡ºå˜´æä¸€å¥ [pacote](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnpm%2Fpacote%2Fblob%2F2ddf67f7c4%2Flib%2Findex.js)æ„Ÿå…´è¶£çš„å¯ä»¥æ¥ä¸€èµ·ç ”ç©¶ä¸€ä¸‹ç»†èŠ‚,æˆ‘ç›®å‰æœ‰ç‚¹ä¸å¤ªèƒ½çœ‹æ‡‚; å¤§æ¦‚çš„æ€è·¯æ˜¯ç»“åˆç½‘ç»œè¯·æ±‚å’Œæ–‡ä»¶è¯»å†™é…ç½®è¿›è¡Œæœ¬åœ°çš„ç¼“å­˜å†™å…¥å’Œç”Ÿæˆå¯¹åº”çš„å‹ç¼©æ–‡ä»¶,[è¿™é‡Œé€šè¿‡å¯¹ä¸€ä½å¤§ä½¬æ–‡ç« å­¦ä¹ æœ‰æ‰€å¾—](https://juejin.cn/post/6844903785018425351#heading-4))

npmä¸»è¦æœ‰ä¼šæœ‰ä¸‰ä¸ªåœ°æ–¹ç”¨åˆ° `pacote`:

- å½“ä½ æ‰§è¡Œ npm install xxx (è¿™æ—¶å€™ä¼šé€šè¿‡ `pacote.extract` æŠŠå¯¹åº”çš„åŒ…è§£å‹åˆ°å¯¹åº”çš„`node_modules` ä¸‹é¢, `pacote`æºç åœ°å€: [extract.js](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzkat%2Fpacote%2Fblob%2Flatest%2Fextract.js%23L19))
- å½“ä½ æ‰§è¡Œ npm cache add xxx (è¿™æ—¶å€™ä¼šé€šè¿‡ `pacote.tarball ä¸‹çš„ tarballStream`å¾€æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„ `_cacache`æ–‡ä»¶ä¸‹å»æ·»åŠ ç¼“å­˜, `pacote`æºç åœ°å€: [tarballStream](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnpm%2Fpacote%2Fblob%2F2ddf67f7c4e084ffec315f94e30bb24f944403e3%2Flib%2Ffetcher.js%23L292)ï¼‰
- å½“ä½ æ‰§è¡Œ [npm pack xxx](https://link.juejin.cn?target=https%3A%2F%2Fdocs.npmjs.com%2Fcli%2Fv8%2Fcommands%2Fnpm-pack) é€šè¿‡ `pacote.tarball ä¸‹çš„ _toFile`åœ¨å½“å‰è·¯å¾„ç”Ÿæˆå¯¹åº”çš„å‹ç¼©æ–‡ä»¶, æºç åœ°å€:[_toFile](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnpm%2Fpacote%2Fblob%2F2ddf67f7c4e084ffec315f94e30bb24f944403e3%2Flib%2Ffetcher.js%23L383) )

å½“`npm`ä¸‹è½½ä¾èµ–çš„æ—¶å€™, å…ˆä¸‹è½½åˆ°ç¼“å­˜å½“ä¸­,å†è§£å‹åˆ°æˆ‘ä»¬çš„é¡¹ç›®çš„ `node_modules`ä¸­ã€‚ å…¶å® `pacote`æ˜¯ä¾èµ–[ npm-registry-fetch](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnpm%2Fnpm-registry-fetch%23npm-registry-fetch)æ¥ä¸‹è½½åŒ…, npm-registry-fetch å¯ä»¥é€šè¿‡è®¾ç½® cache å­—æ®µè¿›è¡Œç›¸å…³çš„ç¼“å­˜å·¥ä½œã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/51732648a8224aa48ffca18540911f22~tplv-k3u1fbpfcp-watermark.awebp?)

ç´§æ¥ç€å‘¢, æˆ‘ä»¬åœ¨æ¯æ¬¡å»å®‰è£…èµ„æºçš„æ—¶å€™,ä¼šæ ¹æ®`package-lock.json`ä¸­çš„

- integrity
- verison
- name

integrityã€verisonã€name ç›¸å…³ä¿¡æ¯ä¼šç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„key;è¿™ä¸ªkey å°±èƒ½å¤Ÿå¯¹åº”ä¸Š index-v5 ç›®å½•ä¸‹çš„ç¼“å­˜è®°å½•; å¦‚æœå‘ç°æœ‰ç¼“å­˜èµ„æº,å°±ä¼šå»æ‰¾åˆ° tar åŒ…å¯¹åº”çš„`hash`å€¼. æ ¹æ® `hash`å†å»æ‰¾ç¼“å­˜ä¸­çš„`tar`åŒ…,ç„¶åå†æ¬¡é€šè¿‡ `pacote`å°†äºŒè¿›åˆ¶æ–‡ä»¶è§£å‹ç¼©è¿›æˆ‘ä»¬é¡¹ç›®çš„ `node_modules`ç›®å½•ä¸­ï¼Œè¿™æ ·å°±çœå»äº†èµ„æºä¸‹è½½çš„ç½‘ç»œå¼€é”€ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/729870ff041e4f36ae2965dbd481d076~tplv-k3u1fbpfcp-watermark.awebp?)

**è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯, è¿™é‡Œçš„ç¼“å­˜ç­–ç•¥æ˜¯åœ¨ npm v5å¼€å§‹çš„,é‚£ä¹ˆåœ¨ v5ä¹‹å‰å‘¢, æ¯ä¸ªç¼“å­˜æ¨¡å—æ˜¯åœ¨æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ ~./npmrc æ–‡ä»¶ä¸­ä»¥æ¨¡å—åçš„æ ¼å¼ç›´æ¥å­˜å‚¨çš„**

**å­˜å‚¨çš„æ ¼å¼:**`{cache}{name}{version}`ã€‚

ä»Šå¤©å¯èƒ½åä¹…äº†,è‚šå­æœ‰ç‚¹ä¸æ¶ˆåŒ–,æš‚æ—¶æ›´æ–°åˆ°è¿™é‡Œ, è°¢è°¢å¤§å®¶çš„æ”¯æŒä¸åšçˆ±ï¼ŒğŸŒ¹ğŸŒ¹ğŸŒ¹ã€‚

å‚è€ƒèµ„æ–™:

[yarnå®˜ç½‘](https://link.juejin.cn?target=https%3A%2F%2Fyarn.bootcss.com%2F)

[npm-about](https://link.juejin.cn?target=https%3A%2F%2Fdocs.npmjs.com%2Fabout-npm)

[å‰ç«¯åŸºç¡€å»ºè®¾ä¸æ¶æ„ 30 è®²](https://link.juejin.cn?target=https%3A%2F%2Fkaiwu.lagou.com%2Fcourse%2FcourseInfo.htm%3FcourseId%3D584%23%2Fdetail%2Fpc%3Fid%3D5905)

[npm install åŸç†åˆ†æ](https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Farticle%2F1555982)

[Node.js åŒ…ç®¡ç†å™¨å‘å±•å²](https://link.juejin.cn?target=https%3A%2F%2Fwxsm.space%2F2021%2Fnpm-history%2F)

[dependencies devDependencies peerDependenciesä¸‰è€…çš„åŒºåˆ«](https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fweixin_43459866%2Farticle%2Fdetails%2F112392975)

[ä¸€æ–‡ææ‡‚peerDependencies](https://link.juejin.cn?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000022435060)

[[package-lock.jsonå’Œyarn.lockçš„åŒ…ä¾èµ–åŒºåˆ«](https://link.juejin.cn?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000017075256)]

[npm å’Œ yarn ç¼“å­˜ç­–ç•¥å¯¹æ¯”](https://link.juejin.cn?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000009709213)

[ä½œä¸ºå‰ç«¯å·¥ç¨‹å¸ˆä½ çœŸçš„çŸ¥é“ npm install åŸç†ä¹ˆï¼Ÿ](https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F128625669)

[# è®°ä¸€æ¬¡æ’é”™ç»å†â€”â€”npmç¼“å­˜æµ…æ](https://juejin.cn/post/6844903785018425351)