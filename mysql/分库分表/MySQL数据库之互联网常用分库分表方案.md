[TOC]

# 一、数据库瓶颈
不管是IO瓶颈，还是CPU瓶颈，最终都会导致数据库的活跃连接数增加，进而逼近甚至达到数据库可承载活跃连接数的阈值。在业务Service来看就是，可用数据库连接少甚至无连接可用。接下来就可以想象了吧（并发量、吞吐量、崩溃）。

## 1.1 IO瓶颈
第一种：磁盘读IO瓶颈，热点数据太多，数据库缓存放不下，每次查询时会产生大量的IO，降低查询速度 -> **分库和垂直分表**。

第二种：网络IO瓶颈，请求的数据太多，网络带宽不够 -> **分库**。

## 1.2 CPU瓶颈
第一种：SQL问题，如SQL中包含join，group by，order by，非索引字段条件查询等，增加CPU运算的操作 -> SQL优化，建立合适的索引，在业务Service层进行业务计算。

第二种：单表数据量太大，查询时扫描的行太多，SQL效率低，CPU率先出现瓶颈 -> **水平分表**。

# 二、分库分表
## 2.1 水平分库
![](https://images2018.cnblogs.com/blog/955136/201808/955136-20180806205041600-432363041.png)

1. 概念：以字段为依据，按照一定策略（hash、range等），将一个库中的数据拆分到多个库中。
2. 结果：
  - 每个库的结构都一样；
  - 每个库的数据都不一样，没有交集；
  - 所有库的并集是全量数据；
3. 场景：系统绝对并发量上来了，分表难以根本上解决问题，并且还没有明显的业务归属来垂直分库。
4. 分析：库多了，io和cpu的压力自然可以成倍缓解。

## 2.2 水平分表
![](https://images2018.cnblogs.com/blog/955136/201808/955136-20180806210016545-644285275.png)


