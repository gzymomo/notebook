- [数据血缘 · 衡石分析平台使用手册 (hengshi.com)](https://docs.hengshi.com/v3.3/data-lineage.html)

# 1. 数据血缘

## 1.1. 数据血缘是什么

数据血缘 (Data Lineage) 是数据的生命周期，展示了从数据源头到数据目标之间的转换过程。

- 数据来源：可以是所有类型的数据集，但根部一定是本地文件数据集、SQL数据集、直连数据集
- 数据目标：fusion数据集、union数据集、append数据集、aggregate数据集、引用数据集
- 转换过程：fusion、union、append、aggregate、引用

## 1.2. 需求来源

客户的数据集会有很长的处理路径，需要方便直观的看到数据集的处理路径：一个数据集依赖了哪些数据集，生成了哪些数据集。

当更新数据集时，为了保证能取到最新的数据，需要查看它上游的数据集是否及时更新了。

当编辑数据集时，需要知道修改它会影响哪些对象。

## 1.3. 功能说明

打开应用，我们针对数据血缘功能新增了一个tab叫“数据血缘”。在左侧数据集列表中点击一个数据集，右侧面板上方会展示其数据血缘图，面板下方会展示该数据集影响的对象。

![img](https://docs.hengshi.com/v3.3/images/data-lineage.png)

### 1.3.1. 数据血缘图

数据血缘图会展示所选数据集、所选数据集依赖的数据集、所选数据集参与生成的数据集。所选数据集会高亮显示。

hover到每个数据集卡片上后，卡片右上角会有跳转图标，可以点击跳转到当前数据集的主页。

同时在卡片上会显示每个数据集的更新时间，方便用户检查数据集之间的更新调度计划是否恰当，数据集是否及时更新了。当数据集更新失败时，更新时间前面会展示更新失败图标。

### 1.3.2. 影响的对象

影响的对象会列出当前数据集影响的图表、数据集、数据准备、数据模型。

比如，想要查看影响的数据集，就切换到`数据集`tab：

![img](https://docs.hengshi.com/v3.3/images/data-lineage-impact-dataset.png)

#### 图表

- 直接使用该数据集做的图表
- 下游数据集使用该数据集字段做的图表，例如：A和B fusion 生成C，然后使用C中B的字段做了图D，那么B影响的图表会有D，但A影响的图表不会有D
- 在数据模型中，复用该数据集的数据集做的图表，比如在数据模型中，将数据集A拖入两次，第二次拖入的数据集是A(2)，那么使用A(2)做的图表也会出现在A的影响图表中

#### 数据集

列出其下游数据集，即直接参与生成或间接参与生成的数据集。

#### 数据准备

列出其作为输入节点的数据准备项目。

#### 数据模型

只列出其作为关联表(从表)的数据模型，不列出其作为模型表的数据模型，因为它肯定会影响自己，所以在此无需列出。

## 1.4. 权限控制

因为数据血缘会显示数据集的全链路，以及影响的对象，这些影响的对象并不希望被应用查看者/租户使用者看到。 数据血缘的设计目的在于让数据集管理者去根据数据血缘进行更好的数据集设计，修改数据集时看到影响的对象。 对于查看者来说，这些管理功能没有必要看到，所以数据血缘对于应用查看者和租户使用者不可见。

- 数据血缘对于以下用户开放：应用创作个人空间中应用的所有者、协作者，应用创作共享空间中应用的管理者、编辑者，数据集市区应用的管理者、编辑者。
- 数据血缘对于应用的查看者、租户使用者是不可见的，因为不希望查看者、租户使用者看到数据集的全链路以及所有影响对象。