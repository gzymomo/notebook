- [数据仓库学习笔记 | 数仓建设规范指南：二、数仓公共开发规范 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/562698949)

# 1.层次调用规范

**稳定业务**按照标准的数据流向进行开发，即ODS→DWD→DWM→DWS→ADS。非稳定业务或探索性需求， 可以遵循ODS→DWD→ADS或ODS→DWD→DWM→ADS数据流开发。

分层引用原则：

- 如果出现ODS→DWD→DWS→ADS流向，说明主题域未覆盖完全，即DWM层未覆盖全DWD层数据，对于使用频率低的少量DWD层表是允许DWD→DWS的。
- 尽量避免出现DWS层表同时使用DWD层和DWM层（该DWD所属主题域）数据表。
- 尽量避免同一主题域内，DWM生成DWM层表。
- DWM、DWS和ADS层表禁止使用ODS层表。
- **禁止出现反向依赖**，比如DWM层表使用DWS层表。

# 2.数据类型规范

统一规定不同字段的数据类型。比如字符串STRING、时间STRING、金额DOUBLE等。

# 3.数据冗余规范

宽表的冗余字段要确保：

（1）冗余字段要使用高频， 下游 3 个或以上使用。

（2）冗余字段引入不应造成本身数据产生过多的延后。

（3）冗余字段和已有字段的重复率不应过大， 原则上不应超过 60%， 如需要可以选择 join 或原表拓展。

# 4.NULL字段处理规范

维度字段设置为-1，指标字段设置为0。

# 5.指标口径规范

保证主题域内， 指标口径一致， 无歧义。

# 6.数据表处理规范

| 表类型 | 记录内容                                                     | 分区情况     | 上报内容           |
| ------ | ------------------------------------------------------------ | ------------ | ------------------ |
| 全量表 | 前一天的所有数据                                             | 无分区       | 所有数据           |
| 增量表 | 每天的新增数据                                               | 每天一个分区 | 只报变化量         |
| 快照表 | 每天的所有数据                                               | 每天一个分区 | 所有数据           |
| 拉链表 | 每天的所有数据（维护历史状态和最新状态，比快照表节省存储空间） | 一个分区     | 历史记录的最终状态 |

例子：在拉链表中获取截止到20220813的全量数据，其where过滤条件就是where start_date<='20220813' and end_date>=20220813。

# 7.表的生命周期管理

**（1）历史数据等级划分**

P0：非常重要的主题域数据和非常重要的应用数据， 具有不可恢复性。

P1：重要的业务数据和重要的应用数据， 具有不可恢复性。

P2：重要的业务数据和重要的应用数据， 具有可恢复性。

P3：不重要的业务数据和不重要的应用数据， 具有可恢复性。

**（2）表类型划分**

1）事件型流水表（增量表）

指数据无重复或者无主键数据， 如日志。

2）事件型镜像表（增量表）

指业务过程性数据， 有主键， 但是对于同样主键的属性会发生缓慢变化。

3）维表

维表包括维度与维度属性数据。

4）Merge 全量表

Merge全量表包括业务过程性数据或者维表数据。

5）ETL临时表

指ETL处理过程中产生的临时表数据。

6）TT临时数据

TT拉取的数据和DbSync产生的临时数据最终会流转到 ODS 层， ODS 层数据作为原始数据保留下来， 从而使得TT&DbSync上游数据成为临时数据。

7）普通全量表

根据历史数据等级划分和表类型划分，可生成相应的生命周期管理矩阵，如下表（ODS层和DWD层的第二个“事件型流水表（增量表）”改为“ 事件型镜像表（ 增量表）”）：

![img](https://pic2.zhimg.com/80/v2-e4bd59be66a706cb012577a2a3fa6f7d_1440w.webp)