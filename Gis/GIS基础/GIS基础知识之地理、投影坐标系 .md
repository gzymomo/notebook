[GIS基础知识之地理、投影坐标系](https://juejin.cn/post/6961405635850141704)

## 1. 大地测量学 (Geodesy)

大地测量学是一门量测和描绘地球表面的学科，也包括确定地球重力场和海底地形。

### 1.1 大地水准面 (geoid)

大地水准面是海洋表面在排除风力、潮汐等其它影响，只考虑重力和自转影响下的形状，这个形状延伸过陆地，生成一个密闭的曲面。虽然我们通常说地球是一个球体或者椭球体，但是由于地球引力分布不均（因为密度不同等原因），大地水准面是一个不规则的光滑曲面。虽然不规则，但是可以近似地表示为一个椭球体，这个椭球体被 称为参考椭球体（Reference ellipsoid）。大地水准面相对于参考椭球体的高度被称为 Undulation of the geoid 。这个波动并不是非常大，最高在冰岛为85m，最低在印度南部为 −106 m，一共不到200m。下图来自维基百科，表示 EGM96 geoid 下不同地区的 Undulation。

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5086461c9c32401b973a0dbd73262ab6~tplv-k3u1fbpfcp-watermark.image)

### 1.2 参考椭球体（Reference ellipsoid）

参考椭球体（Reference ellipsoid）是一个数学上定义的地球表面，它近似于大地水准面。因为是几何模型，可以用长半轴、短半轴和扁率来确定。我们通常所说的经度、纬度以及高度都以此为基础。

一方面，我们对地球形状的测量随着时间迁移而不断精确，另一方面，因为大地水准面并不规则，地球上不同地区往往需要使用不同的参考椭球体，来尽可能适合当地的大地水准面。历史上出现了很多不同的参考椭球体，很多还仍然在使用中。国内过去使用过“北京54”和“西安90”两个坐标系，其中北京54使用的是克拉索夫斯基（Krasovsky）1940的参考椭球，西安80使用的是1975年国际大地测量与地球物理联合会第16届大会推荐的参考椭球。当前世界范围内更普遍使用的是WGS所定义的参考椭球。

## 2. 坐标系（coordinate system）

有了参考椭球体这样的几何模型后，就可以定义坐标系来进行描述位置，测量距离等操作，通常有两种坐标系 地理坐标系（geographic coordinate systems） 和 投影坐标系（projected coordinate systems）。

### 2.1 地理坐标系（Geographic coordinate system）

地理坐标系一般是指由经度、纬度和高度组成的坐标系，能够标示地球上的任何一个位置。

前面提到了，不同地区可能会使用不同的参考椭球体，即使是使用相同的椭球体，也可能会为了让椭球体更好地吻合当地的大地水准面，而调整椭球体的方位，甚至大小。这就需要使用不同的大地测量系统（Geodetic datum）来标识。

因此，对于地球上某一个位置来说，使用不同的测量系统，得到的坐标是不一样的。我们在处理地理数据时，必须先确认数据所用的测量系统。

事实上，随着我们对地球形状测量的越来越精确，北美使用的 NAD83 基准和欧洲使用的 ETRS89 基准，与 WGS 84 基准是基本一致的，甚至我国的 CGCS2000 与WGS84之间的差异也是非常小的。但是差异非常小，不代表完全一致，以 NAD83 为例，因为它要保证北美地区的恒定，所以它与 WGS84 之间的差异在不断变化，对于美国大部分地区来说，每年有1-2cm的差异。

#### 2.1.1 地理坐标系的列举

我们通常用经纬度来表示一个地理位置，但是由于一些原因，我们从不同渠道得到的经纬度信息可能并不是在同一个坐标系下。

- 高德地图、腾讯地图以及谷歌中国区地图使用的是GCJ-02坐标系
- 百度地图使用的是BD-09坐标系
- 底层接口(HTML5 Geolocation或ios、安卓API)通过GPS设备获取的坐标使用的是WGS-84坐标系

不同的坐标系之间可能有几十到几百米的偏移，所以在开发基于地图的产品，或者做地理数据可视化时，我们需要修正不同坐标系之间的偏差。

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/74f0f75eac99497482d57ca31471850c~tplv-k3u1fbpfcp-watermark.image)

#### 2.1.2  WGS-84 - 世界大地测量系统

WGS-84（World Geodetic System, WGS）是使用最广泛的坐标系，也是世界通用的坐标系，别名有：**WGS:1984**、**EPSG:4326**。GPS设备得到的经纬度就是在WGS84坐标系下的经纬度。通常通过底层接口得到的定位信息都是WGS84坐标系。

#### 2.1.3  GCJ-02 - 国测局坐标系

GCJ-02（G-Guojia国家，C-Cehui测绘，J-Ju局），又被称为火星坐标系，是一种基于WGS-84制定的大地测量系统，由中国国测局制定。此坐标系所采用的混淆算法会在经纬度中加入随机的偏移。

GCJ-02坐标系应用的一些地图列举：google中国地图、soso地图、aliyun地图、mapabc地图和高德地图等。

**🚨 注意：**

> 国家规定，中国大陆所有公开地理数据都需要至少用GCJ-02进行加密，也就是说我们从国内公司的产品中得到的数据，一定是经过了加密的。绝大部分国内互联网地图提供商都是使用GCJ-02坐标系，包括高德地图，谷歌地图中国区等。

> 导航电子地图在公开出版、销售、传播、展示和使用前，必须进行空间位置技术处理。 — GB 20263―2006《导航电子地图安全处理技术基本要求》，4.1

#### 2.1.4  BD-09 - 百度坐标系

BD-09（Baidu, BD）是百度地图使用的地理坐标系，其在GCJ-02上多增加了一次变换，用来保护用户隐私。从百度产品中得到的坐标都是BD-09坐标系。

#### 2.1.5 CGCS2000 - 国家大地坐标系

2000国家大地坐标系，是我国当前最新的国家大地坐标系，英文名称为China Geodetic Coordinate System 2000，英文缩写为CGCS2000。

2000国家大地坐标系的原点为包括海洋和大气的整个地球的质量中心；2000国家大地坐标系的Z轴由原点指向历元2000.0的地球参考极的方向，该历元的指向由国际时间局给定的历元为1984.0的初始指向推算，定向的时间演化保证相对于地壳不产生残余的全球旋转，X轴由原点指向格林尼治参考子午线与地球赤道面（历元2000.0）的交点，Y轴与Z轴、X轴构成右手正交坐标系。采用广义相对论意义下的尺度。

#### 2.1.6 地理坐标系相互转换

GCJ-02和BD-09都是用来对地理数据进行加密的，所以也不会公开逆向转换的方法。理论上，GCJ-02的加密过程是不可逆的，但是可以通过一些方法来逼近接原始坐标，并且这种方式的精度很高。[gcoord](https://github.com/hujiulong/gcoord)使用的纠偏方式达到了厘米级的精度，能满足绝大多数情况。

### 2.2 投影坐标系（Projected coordinate systems）

一个投影坐标系统就是定义了如何将一个三维的模型转换为一个二维的平面（这样相比于地球仪更容易携带），这个在数学上被称为投影。

地理坐标系是三维的，我们要在地图或者屏幕上显示就需要转化为二维，这被称为投影（Map projection）。显而易见的是，从三维到二维的转化，必然会导致变形和失真，失真是不可避免的，但是不同投影下会有不同的失真，这让我们可以有得选择。常用的投影有等矩矩形投影（Platte Carre）和墨卡托投影（Mercator），下图来自[Mercator vs. well…not Mercator (Platte Carre)](https://idvux.wordpress.com/2007/06/06/mercator-vs-well-not-mercator-platte-carre/)，生动地说明了这两种投影下的失真：

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/49f3f0a1f33645cda3a6b31e0abc0cb7~tplv-k3u1fbpfcp-watermark.image)

左图表示地球球面上大小相同的圆形，**右上**为**墨卡托投影**，投影后仍然是圆形，但是在高纬度时物体被严重放大了。**右下**为**等距投影**，物体的大小变化不是那么明显，但是图像被拉长了。等矩矩形投影（Platte Carre）因为在投影上有扭曲，并不适合于航海等活动，但是因为坐标与像素之间的对应关系十分简单，非常适合于栅格图的展示，等矩矩形投影（Platte Carre）是很多GIS软件的默认投影。

需要注意的是，对于墨卡托投影来说，越到高纬度，大小扭曲越严重，到两极会被放到无限大，所以，墨卡托投影无法显示极地地区。下图来自维基百科，可以看到墨卡托投影下每个国家的大小和实际大小的差异。但是 conformality（正形性） 和 straight rhumb lines 这两个特点，让它非常适合于航海导航。

**投影变形**的形式：角度变形、长度变形和面积变形。

地图投影的方式：

- 等角投影——投影前后的角度相等，但长度和面积有变形；
- 等距投影——投影前后的长度相等，但角度和面积有变形；
- 等积投影——投影前后的面积相等，但角度和长度有变形。

还要了解一点，**投影坐标系的基础是地理坐标系，没有地理坐标系，也就没有所谓的投影坐标系**，投影坐标系是地理坐标系上的地物投射到具体投影面上的一种结果。

#### 2.2.1 投影坐标系的列举

- 墨卡托投影
- 高斯-克吕格投影
- 通用横轴墨卡托投影
- web墨卡托投影（Web Mercator） EPSG:3857

## 3. 对于 Web Map 开发人员的意义

对于 Web Map 开发人员来说，最熟悉的应该是EPSG:4326 (WGS84) and EPSG:3857(Pseudo-Mercator)，这又是啥呢？

大部分时候，Web 地图在存储数据的时候都是使用的 WGS84 的坐标系统（在有些系统中，这个规格被称之为「未投影」的数据）并且在可视化的时候使用EPSG:3857 (Pseudo-Mercator)。

GPS是基于WGS84的，所以通常我们得到的坐标数据都是WGS84的。一般我们在存储数据时，仍然按WGS84存储。WGS84 通常使用 GeoJSON 作为坐标系统的单位，GeoJSON 中使用数字作为经度和纬度的单位。大部分时候，当你描述一个经纬度坐标的时候，它就是基于 EPSG:4326 坐标系统的。这也是我们在 Mapbox 中储存数据的方式。

而要把WGS84格式的GeoJSON数据可视化展示，需要将3维的数据展示到2维的平面上，这时就需要**伪墨卡托投影**，也被称为球体墨卡托、web墨卡托投影，Web Mercator，EPSG:3857。它是基于墨卡托投影的，把 WGS84坐标系投影到正方形。

我们前面已经知道 WGS84 是基于椭球体的，但是伪墨卡托投影把坐标投影到球体上，这导致两极的失真变大，但是却更容易计算。这也许是为什么被称为”伪“墨卡托吧。另外，伪墨卡托投影还切掉了南北85.051129°纬度以上的地区，以保证整个投影是正方形的。因为墨卡托投影等正形性的特点，在不同层级的图层上物体的形状保持不变，一个正方形可以不断被划分为更多更小的正方形以显示更清晰的细节。

很明显，伪墨卡托坐标系是非常显示数据，但是不适合存储数据的，通常我们使用WGS84 存储数据，使用伪墨卡托显示数据。（这也是为什么 mapBox 在存储数据的时候使用的是 EPSG:4326 但是展示的时候使用 EPSG:3857）。

## 4. 参考

- [EPSG 4326 vs EPSG 3857 (投影，数据集，坐标系统等等)](https://github.com/penouc/blog/issues/1)
- [GIS基础知识 - 坐标系、投影、EPSG:4326、EPSG:3857](https://www.cnblogs.com/E7868A/p/11460865.html)
- [投影坐标系（PCS）](https://zhuanlan.zhihu.com/p/139983047)